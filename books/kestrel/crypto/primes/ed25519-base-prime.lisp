; Primes Library: Base Field Prime for Ed25519
;
; Copyright (C) 2025 Eric McCarthy (bendyarm on GitHub)
;
; License: See the LICENSE file distributed with this library.
;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;; The elliptic curve Ed25519 is defined over a finite field with a large prime.
;; This prime number is called the base field prime for the Ed25519 curve
;; and is used for all field arithmetic operations in the curve.
;; The Pratt certificate in this file is used to prove primality of this number.
;; See also the file ed25519-group-prime.lisp

;; References for Ed25519:
;; RFC 8032: Edwards-Curve Digital Signature Algorithm (EdDSA)
;; https://tools.ietf.org/rfc/rfc8032.txt
;; Bernstein et al.: "Ed25519: High-speed high-security signatures"
;; https://ed25519.cr.yp.to/

;; See also books/projects/numbers/pratt.lisp
;; thanks to David M. Russinoff
;; which introduces Pratt certificates in ACL2
;; and defines a simpler Pratt certificate for this same prime number.

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(in-package "PRIMES")

(include-book "kestrel/number-theory/defprime" :dir :system)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defprime ed25519-base-prime

  #x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed

  ;; The following certificate was generated by Cursor (Claude 4 Sonnet)
  ;; using SageMath.
  ;; The Ed25519 base prime is 2^255 - 19
  ;; This is a 255-bit prime number.

  ;; 57896044618658097711785492504343953926634992332820282019728792003956564819949
  (2 (2 3 65147 74058212732561358302231226437062788676166966415465897661863160754340907)
     (2 1 1 1)
     (() () ()
      ;; 74058212732561358302231226437062788676166966415465897661863160754340907
      (2 (2 3 353 57467 132049 1923133 31757755568855353 75445702479781427272750846543864801)
         (1 1 1 1 1 1 1 1)
         (() () () () () 
          ;; 1923133
          (2 (2 3 43 3727)
             (2 1 1 1)
             (() () () ()))
          ;; 31757755568855353
          (10 (2 3 31 107 223 4153 430751)
              (3 1 1 1 1 1 1)
              (() () () () () () ()))
          ;; 75445702479781427272750846543864801
          (7 (2 3 5 75707 72106336199 1919519569386763)
             (5 2 2 1 1 1)
             (() () () ()
              ;; 72106336199
              (7 (2 13 2773320623)
                 (1 1 1)
                 (() ()
                  ;; 2773320623
                  (5 (2 2437 569003)
                     (1 1 1)
                     (() () ()))))
              ;; 1919519569386763
              (2 (2 3 7 19 47 127 8574133)
                 (1 1 1 1 2 1 1)
                 (() () () () () ()
                  ;; 8574133
                  (2 (2 3 7 103 991)
                     (2 1 1 1 1)
                     (() () () () ()))))))))))

  :parents (crypto)

  :short "The Ed25519 base field prime."

  :long
  (xdoc::topstring
   (xdoc::p
    "The Ed25519 base field prime is the size of the finite field
     over which the Edwards curve Ed25519 is defined. This prime is used for
     all field arithmetic operations in the curve.")
   (xdoc::p
    "The prime is computed as:")
   (xdoc::codeblock
    "2^255 - 19")
   (xdoc::p
    "See also "
    (xdoc::ahref
     "https://tools.ietf.org/rfc/rfc8032.txt"
     "RFC 8032")
    " and "
    (xdoc::ahref
     "https://tools.ietf.org/rfc/rfc7748.txt"
     "RFC 7748"))))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; This prime has length 255 bits.

(assert-event (equal (integer-length (ed25519-base-prime)) 255))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Decimal version of this prime.

(assert-event
 (equal (ed25519-base-prime)
        57896044618658097711785492504343953926634992332820282019728792003956564819949))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Verify this equals 2^255 - 19

(assert-event
 (equal (ed25519-base-prime)
        (- (expt 2 255) 19)))
