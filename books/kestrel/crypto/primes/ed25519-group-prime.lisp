; Primes Library: Group Order Prime for Ed25519
;
; Copyright (C) 2025 Eric McCarthy (bendyarm on GitHub)
;
; License: See the LICENSE file distributed with this library.
;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;; The elliptic curve Ed25519 has a large prime subgroup.  The order of
;; this subgroup is used as the scalar field for EdDSA signature operations.
;; The certificate in this file is used to prove primality of this number.
;; See also the file ed25519-base-prime.lisp

;; References for Ed25519:
;; RFC 8032: Edwards-Curve Digital Signature Algorithm (EdDSA)
;; https://tools.ietf.org/rfc/rfc8032.txt
;; Bernstein et al.: "Ed25519: high-speed high-security signatures"
;; https://ed25519.cr.yp.to/

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(in-package "PRIMES")

(include-book "kestrel/number-theory/defprime" :dir :system)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defprime ed25519-group-prime

  #x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed

  ;; The following certificate was generated by Cursor (Claude 4 Sonnet)
  ;; using SageMath.
  ;; The Ed25519 group order is 2^252 + 27742317777372353535851937790883648493
  ;; This is a 253-bit prime number.

  ;; 7237005577332262213973186563042994240857116359379907606001950938285454250989
  (2 (2 3 11 198211423230930754013084525763697 276602624281642239937218680557139826668747)
     (2 1 1 1 1)
     (() () ()
      ;; 198211423230930754013084525763697
      (5 (2 3 23 58964693 3044861653679985063343)
         (4 1 1 1 1)
         (() () ()
          ;; 58964693
          (2 (2 14741173)
             (2 1)
             (()
              ;; 14741173
              (2 (2 3 409477)
                 (2 2 1)
                 (() () ()))))
          ;; 3044861653679985063343
          (5 (2 3 11 30703 82163 132667 137849)
             (1 1 1 1 1 1 1)
             (() () () () () () ()))))
      ;; 276602624281642239937218680557139826668747
      (2 (2 7 19757330305831588566944191468367130476339)
         (1 1 1)
         (() ()
          ;; 19757330305831588566944191468367130476339
          (2 (2 269 213441916511 172054593956031949258510691)
             (1 1 1 1)
             (() ()
              ;; 213441916511
              (13 (2 5 73 292386187)
                  (1 1 1 1)
                  (() () ()
                   ;; 292386187
                   (2 (2 3 307 5879)
                      (1 4 1 1)
                      (() () () ()))))
              ;; 172054593956031949258510691
              (2 (2 5 1361 2851 4434155615661930479)
                 (1 1 1 1 1)
                 (() () () ()
                  ;; 4434155615661930479
                  (17 (2 41 43 1257559732178653)
                      (1 1 1 1)
                      (() () ()
                       ;; 1257559732178653
                       (2 (2 3 7 23 531581 1224481)
                          (2 1 1 1 1 1)
                          (() () () () ()
                           ;; 1224481
                           (13 (2 3 5 2551)
                               (5 1 1 1)
                               (() () () ()))))))))))))))

  :parents (crypto::crypto)

  :short "The Ed25519 group order prime."

  :long
  (xdoc::topstring
   (xdoc::p
    "The Ed25519 group order prime is the order of the largest prime subgroup
     of the Edwards curve Ed25519. This prime is used as the scalar field
     for EdDSA signature operations.")
   (xdoc::p
    (xdoc::ahref
     "https://tools.ietf.org/rfc/rfc8032.txt"
     "RFC 8032")
    " states that the group order (called @($L$)) is equal to "
   (xdoc::codeblock
    "2^252 + 27742317777372353535851937790883648493"))))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; This prime has length 253 bits.

(assert-event (equal (integer-length (ed25519-group-prime)) 253))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Decimal version of this prime.

(assert-event
 (equal (ed25519-group-prime)
        7237005577332262213973186563042994240857116359379907606001950938285454250989))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Verify this equals 2^252 + 27742317777372353535851937790883648493

(assert-event
 (equal (ed25519-group-prime)
        (+ (expt 2 252) 27742317777372353535851937790883648493)))
