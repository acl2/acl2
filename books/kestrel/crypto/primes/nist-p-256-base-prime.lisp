; Primes Library: Base Field Prime for NIST P-256
;
; Copyright (C) 2025 Eric McCarthy (bendyarm on GitHub)
;
; License: See the LICENSE file distributed with this library.
;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;; The elliptic curve NIST P-256 (also known as secp256r1 and prime256v1) is
;; defined over a large prime finite field. This prime number is called
;; the base field prime for the NIST P-256 curve and is used for all field
;; arithmetic operations for the curve. The certificate in this file is used to
;; prove primality of this number.

;; References for NIST P-256 / secp256r1:
;; * Standards for Efficient Cryptograpy
;;   SEC 2: Recommended Elliptic Curve Domain Parameters
;;   https://www.secg.org/sec2-v2.pdf (Section 2.4.2, p.9)
;; * Standard curve database
;;   https://neuromancer.sk/std/nist/P-256
;; * See also FIPS 186-5
;;   https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-5.pdf
;; * See also ANSI X9.142-2020 (paywall).

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(in-package "PRIMES")

(include-book "kestrel/number-theory/defprime" :dir :system)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defprime nist-p-256-base-prime

  #xffffffff00000001000000000000000000000000ffffffffffffffffffffffff

  ;; The following certificate was generated by Cursor (Claude 4 Sonnet)
  ;; using SageMath.

  ;; 115792089210356248762697446949407573530086143415290314195533631308867097853951
  (6 (2 3 5 17 257 641 1531 65537 490463 6700417 835945042244614951780389953367877943453916927241)
     (1 1 2 1 1 1 1 1 1 1 1)
     (() () () () () () () () () ()
      ;; 835945042244614951780389953367877943453916927241
      (11 (2 3 5 774023187263532362759620327192479577272145303)
          (3 3 1 1)
          (() () ()
           ;; 774023187263532362759620327192479577272145303
           (3 (2 3 2411 34282281433 11290956913871 46076956964474543)
              (1 2 1 1 1 1)
              (() () ()
               ;; 34282281433
               (17 (2 3 7 204061199)
                   (3 1 1 1)
                   (() () ()
                    ;; 204061199
                    (11 (2 11 23 107 3769)
                        (1 1 1 1 1)
                        (() () () () ()))))
               ;; 11290956913871
               (13 (2 5 17 66417393611)
                   (1 1 1 1)
                   (() () ()
                    ;; 66417393611
                    (6 (2 5 53 173 197 3677)
                       (1 1 1 1 1 1)
                       (() () () () () ()))))
               ;; 46076956964474543
               (5 (2 23 18169 78283 704251)
                  (1 1 1 1 1)
                  (() () () () ()))))))))

  :parents (primes::primes)

  :short "The NIST P-256 base field prime."

  :long
  (xdoc::topstring
   (xdoc::p
    "The NIST P-256 base field prime is the characteristic of the finite field
     over which the Weierstrass elliptic curve @('NIST P-256') is defined. This prime
     is used for all field arithmetic operations in the curve.")
   (xdoc::p
    "The curve @('NIST P-256') is also called @('secp256r1').")
   (xdoc::p
    "The prime is computed as:")
   (xdoc::codeblock
    "2^256 - 2^224 + 2^192 + 2^96 - 1")
   (xdoc::p
    (xdoc::ahref
     "https://www.secg.org/sec2-v2.pdf"
     "SEC 2: Recommended Elliptic Curve Domain Parameters")
    " (Section 2.4.2) calls it @($p$), and specifies its value in hexadecimal:")
   (xdoc::codeblock
    "0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; This prime has length 256 bits.

(assert-event (equal (integer-length (nist-p-256-base-prime)) 256))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Decimal version of this prime.

(assert-event
 (equal (nist-p-256-base-prime)
        115792089210356248762697446949407573530086143415290314195533631308867097853951))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Verify this equals 2^256 - 2^224 + 2^192 + 2^96 - 1

(assert-event
 (equal (nist-p-256-base-prime)
        (+ (- (expt 2 256) (expt 2 224))
           (expt 2 192)
           (expt 2 96)
           -1)))
